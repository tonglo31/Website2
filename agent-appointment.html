<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./img/ico/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/styles/styles.css">
    <link rel="stylesheet" href="./css/fontawesome-free-5.15.1-web/css/all.css">
    <link rel="stylesheet" href="./css/styles/search-property.css">
    <link rel="stylesheet" href="./css/styles/estate.css">
    <link rel="stylesheet" href="./css/styles/appointment.css">
    <link rel="stylesheet" href="./css/styles/chatbox.css">
    <!-- data -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    <script src="./data/house.js"></script>
    <script src="./data/district.js"></script>
    <script src="./js/loadData.js"></script>
    <script src="./data/appointment.js"></script>

    <style>
        .disabled{
            background: #A9A9A9;
        }
        .disabled:hover{
            background: #A9A9A9;
            color: white;
        }
    </style>
    <!-- end of data -->
    <title>Dream House Property | Property Appointment</title>
  </head>
  <body>
    <!-- jquery && bootstrap-->
    <script type="text/javascript" src="./js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="./css/bootstrap-4.5.3-dist/js/bootstrap.js"></script>
    <script type="text/javascript" src="./css/bootstrap-4.5.3-dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="./css/bootstrap-4.5.3-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./js/comment.js"></script>
    <script src="./js/agent-appointment.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <!-- end of jquery  -->
    <!-- navbar -->
    <span class="nav-btn" id="nav-btn">
      <i class="fas fa-bars"></i>
    </span>
    <header class="navbar">
      <span class="nav-close" id="nav-close">
        <i class="fas fa-times"></i>
      </span>
      <img class="navbar-logo" id="navbar-logo" src="./img/icon.jpg" alt="" />
      <nav>
        <ul class="nav-center">
          <li><a href="./property-update.html" class="nav-link">Edit Property</a></li>
          <li><a href="./agent-estate-comment.html" class="nav-link">Search property</a></li>
          <li><a href="./agent-profile.html" class="nav-link">Profile</a></li>
          <li><a href="./agent-appointment.html" class="nav-link">View Appointment</a></li>
        </ul>
      </nav>
      <nav>
        <ul>
          <li><a href="./index.html" class="nav-link" >Sign out</a></li>
        </ul>
      </nav>
    </header>
    <button class="btn chatBtn chatToggle" id="chatToggle">Reply Message<i class="far fa-comment-alt" style="margin-left: 1rem"></i></button>
    <div class="chatbox">
      <div class="chatbox-title">
        <h4><i class="fas fa-comment-alt" style="margin-right: 0.5rem"></i>Reply Message</h4>
      </div>
      <div class="chat-container">
        <div class="reply-content">
          <span class="reply-icon" style="margin-right:0.5rem"><i class="fas fa-user"></i></span>
          <p>I want to change appointment time.
            <br/><span class="reply-time">10:55PM</span></p>
        </div>

      </div> 
      <div class="chatsend-group">
        <form class="chatform" id="replyChatForm" onsubmit="return false;">
            <textarea required id="chatMsg" class="form-input" rows="5" placeholder="leave your message here." style="width:400px"></textarea>
            <button class="btn" style="border-top-left-radius: 4px; border-top-right-radius: 4px; margin:0 auto; display: block;" id="agentSendMsg">Send Message</button>
        </form>
      </div>
    </div>
    <div class="big-wrapper">
      <div class="appointment-title">
        <h2>Check Your Appointment status</h1>
      </div>
      <div class="filter">
        <form onsubmit="return false;">
          <div class="form-group">
            <div>
              <label for="status" class="labelInput">Appointment Status:</label> 
              <select id="status"class="form-input" id="status-select">
                <option value="confirm">Confirmed</option>
                <option value="non-confirm">Not Confirmed</option>
                <option value="all">All</option>
              </select>
            </div>

            <button class="btn" id="filterbtn">Filter estate</button>
          </div>
        </form>
      </div>
      <div class="featured-estate-container">

      </div>
    </div>
    <form id="alertMessage" class="modal">
      <span class="special-title">Cannot find any result!!!</span>
      <button class="btn" style="margin-left: 2rem; border-radius: 8px">Close</button>
    </form>


    <form id="nonconfirm-form" class="modal" onsubmit="return false;">
        <h4 style="margin: 2rem">Confirm Appointment</h4>

        <div class="form-group">
            <label for="estate-name">Estate Name: </label>
            <input class="form-input" type="text" id="estate-name" readonly >
        </div>
        <div class="form-group">
            <label for="fullname">User Fullname: </label>
            <input class="form-input" type="text" id="fullname" readonly >
        </div>
        <div class="form-group">
            <label for="phone">User Contact: </label>
            <input class="form-input" type="number" id="phone" readonly >
        </div>
        <div class="form-group">
            <label for="date">Preferred Date: </label>
            <input class="form-input" type="date" id="date"  required>
        </div>
        <div class="form-group">
            <label for="datetime">Preferred Time: </label>
            <input class="form-input" type="time" min="09:00" max="18:00" id="datetime"  required>
        </div>
        <div class="form-group">
            <input class="form-input" type="text" id="update" placeholder="type confirm to update appointment">
            <button class="btn btnConfirm disabled" style="display: block; margin:2rem auto; width: 200px;" id="confirm" disabled>Confirm</button>
        </div>
    </form>

    <form id="updateAlert" class="modal" onsubmit="return false;">
      <h4 style="margin: 2rem auto;"><i class="fas fa-check-circle" style="padding-right: 1.25rem;color:#008000;font-size: 2rem"></i>Appointment Confirmed</h4>
    </form>

    <form id="confirmed-form" class="modal" onsubmit="return false;">
      <h4 style="margin: 2rem">Confirmed Appointment Details</h4>

      <div class="form-group">
          <label for="estate-name">Estate Name: </label>
          <input class="form-input" type="text" id="estate-name1" readonly >
      </div>
      <div class="form-group">
          <label for="fullname">User Fullname: </label>
          <input class="form-input" type="text" id="fullname1" readonly >
      </div>
      <div class="form-group">
          <label for="phone">User Contact: </label>
          <input class="form-input" type="number" id="phone1" readonly >
      </div>
      <div class="form-group">
          <label for="date">Confirmed Date: </label>
          <input class="form-input" type="date" id="date1"  readonly>
      </div>
      <div class="form-group">
          <label for="datetime">Confirmed Time: </label>
          <input class="form-input" type="time" min="09:00" max="18:00" id="datetime1"  readonly>
      </div>
      <div class="form-group">
        <button class="btn btnConfirm" style="display: block; margin:2rem auto; width: 200px;" id="closeBtn">Close</button>
      </div>
  </form>

  <form id="alertMessage1" class="modal" onsumbit="return false;">
    <span class="special-title">Cannot find any result!!!</span>
    <button class="btn" id="closeMessage" onclick="$('#closeMessage').click(function(){$.modal.close()});" style="margin-left: 2rem; border-radius: 8px">Close</button>
  </form>

    <script src="./js/navbar.js"></script>
    <script>
      $(document).ready(function() {
        appendAgentAppointment();
        var parent;
        var calledAppointment = function(){
           parent =  getAppointmentDetails($(this));
           $("#nonconfirm-form").modal();
        };
        var canViewDetails = function (){
          parent = getConfirmedAppointmentDetails($(this));
          $("#confirmed-form").modal();
        };
        $("#confirmApp").click(calledAppointment);

        $('#update').on('input propertychange paste', function() {
             if($(this).val() == "confirm" || $(this).val() == "Confirm") {
                $("#confirm").removeAttr("disabled");
                $("#confirm").removeClass("disabled");
             } else {
                $("#confirm").prop('disabled', true);
                $("#confirm").addClass("disabled");
             }
        });
        $("#confirm").on("click",function(){
            if(document.getElementById("nonconfirm-form").checkValidity()){
              var target = parent.parent().find(".featured-estate-info");
              target.find(".appointment-status").html('Status: <span class="special-title">Approved</span>')
              parent.find(".featured-estate-footer").find("p").eq(1).html(`Confirmed Date: <span class="special-title">` + $("#date").val() + "</span>");
              parent.find(".featured-estate-footer").find("p").eq(3).html(`Confirmed Time: <span class="special-title">` + $("#datetime").val() + "</span>");
              parent.siblings(".estate-img-container").find("p").html(`<i class="fas fa-check-circle"></i>&nbsp; Confirm Appointment`);
              $("#confirmApp").unbind("click");
              parent.siblings(".estate-img-container").find("p").removeAttr("id");
              parent.siblings(".estate-img-container").find("p").addClass("canViewDetails");
              $.modal.close();
              $("#updateAlert").modal();
            }
        });
        $(document).on("click", ".canViewDetails", canViewDetails);
        $("#closeBtn").click(function(){
          $.modal.close();
        })
        $("#filterbtn").click(function() {
          filterAppointment();
          var x = $(".featured-estate-container").children().length;
          if(x <= 0){
            $("#alertMessage1").modal();
          }
        });
        $(".chatbox").hide();
        $("#agentSendMsg").click(function(){
          if(document.getElementById("replyChatForm").checkValidity()){
            var today = new Date();
            var currentHours = today.getHours();
            var currentMins = today.getMinutes();
            currentMins = ("0" + currentMins).slice(-2)
            currentHours = ("0" + currentHours).slice(-2);
            $(".chat-container").append(` <div class="reply-content user-reply">
          <p>`+ $("#chatMsg").val() + `
            <br/><span class="reply-time" style="margin-top: 1rem;">Reply on ` + currentHours + ":" + currentMins + `</span></p>
        </div>`)
            $("#chatMsg").val('');
            setTimeout(function() {
              $(".chat-container").animate({ scrollTop: $(".chat-container").prop("scrollHeight") });
              }, 500);
          }
        });

        $("#chatToggle").click(function(){
          if($(".chatbox").is(":visible")){
            $(".chatbox").fadeOut(200); 
          } else {
            $(".chatbox").fadeIn(200);
          }
        });
      });
    </script>
  </body>
</html>
